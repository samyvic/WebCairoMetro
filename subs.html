<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Subscriptions | Cairo Metro</title>
    <link rel="stylesheet" href="stations.css">
    <link rel="stylesheet" href="subs.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script>
         $(document).ready(function() {
            $("#addbtn").click(function(){
               $(".add-station-form").slideToggle(),
               $(".del-station-form").hide()


            });
            $("#delbtn").click(function(){
               $(".del-station-form").slideToggle(),
               $(".add-station-form").hide()


            });

         });
      </script>
      <script>
      //remove station
      // function delstation(){
      //   //stName = document.getElementById('stationName').value;
      //   var staID = document.getElementById('stationID');
      //   // remove(ref(db, 'StationsList/' +stID),{
      //   //
      //   // });
      //   if (staID) {
      //       var input = staID.value;
      //       alert(input);
      //     }
      // }
      // function enterCommand() {
      //   var field = document.getElementById("commandfield");
      //   if (field) {
      //     var input = field.value;
      //     alert(input);
      //   }
      // }
      </script>

  </head>
  <body>
    <div class="cover">
      <div class="container">
        <div class="row">
          <div class="menu" id="menu">
            <div class="avatar">
              <img src="avatar.jpeg" alt="">
              <p>Admin</p>
              <h2>SAMY</h2>
            </div>
            <ul class="list">
              <!-- <a href="dashboard.html"><li><i class="fas fa-home"></i> Dashboard</li></a> -->
              <a href="tickets.html"><li><i class="fas fa-ticket-alt"></i> Tickets</li></a>
              <a href="stations.html"><li><i class="fas fa-subway"></i> Stations</li></a>
              <li  id="active"><i class="fas fa-money-check-alt"></i> Subscriptions</li>
              <!-- <a href="tickets.html"><li><i class="fas fa-ticket-alt"></i> Tickets</li></a> -->
              <!-- <a href="fines.html"><li><i class="fas fa-receipt"></i> Fines</li></a> -->
              <a href="reports.html"><li><i class="fas fa-chart-pie"></i> Reports</li></a>
              <a href="index.html"><li><i class="fas fa-sign-out-alt"></i> Log Out</li></a>
            </ul>
          </div>

          <div class="content">
            <h1>Manage <span>Subscriptions</span></h1>
            <!-- <button type="button" name="button" id="addbtn">Add Station</button>
            <button type="button" name="button" id="delbtn">Remove Station</button>
            <!-- <button type="button" name="button" id="updbtn">Update Station</button>
            <br>
            <br>
            <div class="add-station-form station-form">
              <form class="addStation">

                <label for="stationName">Station Name</label><br>
                <input type="text" id="stationName" name="stationName" placeholder="Enter station name" required>

                <br><br>
                <label for="LineNum">Line Number</label><br>
                <select id="line" name="line" required>
                  <option value="1">Line 1</option>
                  <option value="2">Line 2</option>
                  <option value="3">Line 3</option>
                </select>

                <br><br>
                <label for="stationNum">Number At Line</label><br>
                <input type="number" min="1" oninput="validity.valid||(value='');" id="numAtLine" name="numAtLine" placeholder="Enter station number at this line" required>

                <br><br>
                <label for="interchange">Interchange Station</label><br>
                <!-- <select id="interchangeable" name="interchangeable" onclick="if(this.selectedIndex === 1){dispExch(this.selectedIndex)}else{hideExch(this.selectedIndex)}">
                  <option [ngValue]="false">false</option>
                  <option [ngValue]="true">Yes</option>
                </select>
                <input type="radio" class="interchangeable" name="interchangeable" value="false" onclick="hideExch()"> <span>No</span><br>
                <input type="radio" class="interchangeable" name="interchangeable" value="true" onclick="dispExch()"> <span>Yes</span>

                <br><br>
                <label for="exchange">Interchangeable With Line</label><br>
                <select id="exchangeable" name="exchangeable" required>
                  <option value="1">Line 1</option>
                  <option value="2">Line 2</option>
                  <option value="3">Line 3</option>
                </select>

                <br><br>
                <label for="wheel">Total WheelChairs</label><br>
                <input type="number" min="0" oninput="validity.valid||(value='');" id="wheelChairs" name="wheelChairs" placeholder="Enter the number of wheelchairs at this station" required>

                <br><br>
                <input type="submit" value="Add Station" id="addBtn">
              </form>
            </div>

            <div class="del-station-form station-form">
              <form class="deleteForm">
                <br><br>

                <label for="stationName">Station ID</label><br>
                <input type="text" id="stationID" name="stationID" placeholder="Enter station ID" required>
                <br><br>
                <input type="submit" value="Remove Station" id="delBtn">


                <!-- <button type="button" onclick="delstation()">Enter</button> -->
                <!-- <input type="text" id="commandfield"></input>
                <button type="button" onclick="enterCommand()">Enter</button>
              </form>
            </div>

            <br>
            <br>
            <hr>
            <table id="stations-table" class"stations-table">
              <caption>Stations List</caption>
              <thead>
                <th>Station Name</th>
                <th>Line</th>
                <th>Num</th>
                <th>Change</th>
                <th>WheelChairs</th>
                <th>ID</th>
              </thead>
              <tbody id="stations-tbody">
              </tbody>
            </table> -->

            <!-- <table>
              <caption>Subscriptions</caption>
              <thead>
                <th onclick="openSubTypes('typeOne')">1 Month</th>
                <th onclick="openSubTypes('typeThree')">3 Months</th>
                <th onclick="openSubTypes('typeYear')">1 year</th>
              </thead>
              <tbody>
                <tr id="typeOne" class="subType" style="display:none;">
                  <td>Public</td>
                  <td>Above 60</td>
                </tr>
                <tr id="typeThree" class="subType" style="display:none;">
                  <td>Public</td>
                  <td>Students</td>
                  <td>Injured of Rev.</td>
                  <td>Journalists</td>
                </tr>
                <tr id="typeYear" class="subType" style="display:none;">
                  <td>Public</td>
                </tr>
              </tbody>
            </table> -->

            <div class="getSubs" style="color: #fff;">
              <div class="row">
                <div class="sub-box box">
                  <span onclick="openSubTypes('typeOne')">1 Month</span>
                </div>
                <div class="sub-box box">
                  <span onclick="openSubTypes('typeThree')">3 Months</span>
                </div>
                <div class="sub-box box">
                  <span onclick="openSubTypes('typeYear')">1 Year</span>
                </div>
              </div>
              <div class="row">
                <div id="typeOne" class="subType" style="display:none;">
                  <span onclick="openZone('p1')">Public</span>
                  <span onclick="openZone('s1')">Above 60</span>
                </div>
                <div id="typeThree" class="subType" style="display:none;">
                  <span onclick="openZonee('p2')">Public</span>
                  <span onclick="openZonee('st2')">Students</span>
                  <span onclick="openZonee('r2')">Injured of Rev.</span>
                  <span onclick="openZonee('j2')">Journalists</span>
                </div>
                <div id="typeYear" class="subType" style="display:none;">
                  <span onclick="openZoneee('p3')">Public</span>
                </div>
              </div>
              <div id="oneMonth1" class="row">
                <div id="p1" class="oneMonth" style="display:none;">
                  <div class="public1 z1">
                    <span>1 Zone</span>
                  </div>
                  <div class="public1 z2">
                    <span>2 Zones</span>
                  </div>
                  <div class="public1 z3">
                    <span>3&4 Zones</span>
                  </div>
                  <div class="public1 z4">
                    <span>5&6 Zones</span>
                  </div>
                </div>
              </div>
              <div id="oneMonth2" class="row">
                <div id="s1" class="oneMonth" style="display:none;">
                  <div class="senior1 z5">
                    <span>1 Zone</span>
                  </div>
                  <div class="senior1 z6">
                    <span>2 Zones</span>
                  </div>
                  <div class="senior1 z7">
                    <span>3 Zones</span>
                  </div>
                </div>
              </div>

              <div id="threeMonth1" class="row">
                <div id="p2" class="threeMonth" style="display:none;">
                  <div class="public2 z8">
                    <span>1 Zone</span>
                  </div>
                  <div class="public2 z9">
                    <span>2 Zones</span>
                  </div>
                  <div class="public2 z10">
                    <span>3&4 Zones</span>
                  </div>
                  <div class="public2 z11">
                    <span>5&6 Zones</span>
                  </div>
                </div>
              </div>

              <div id="threeMonth2" class="row">
                <div id="st2" class="threeMonth" style="display:none;">
                  <div class="student2 z12">
                    <span>3 Zone</span>
                  </div>
                  <div class="student2 z13">
                    <span>4 Zones</span>
                  </div>
                </div>
              </div>

              <div id="threeMonth3" class="row">
                <div id="r2" class="threeMonth" style="display:none;">
                  <div class="rev2 z14">
                    <span>1 Zone</span>
                  </div>
                  <div class="rev2 z15">
                    <span>2 Zones</span>
                  </div>
                  <div class="rev2 z16">
                    <span>3 Zones</span>
                  </div>
                  <div class="rev2 z17">
                    <span>4 Zones</span>
                  </div>
                </div>
              </div>

              <div id="threeMonth4" class="row">
                <div id="j2" class="threeMonth" style="display:none;">
                  <div class="jorn2 z18">
                    <span>1 Zone</span>
                  </div>
                  <div class="jorn2 z19">
                    <span>2 Zones</span>
                  </div>
                  <div class="jorn2 z20">
                    <span>3 Zones</span>
                  </div>
                  <div class="jorn2 z21">
                    <span>4 Zones</span>
                  </div>
                </div>
              </div>

              <div id="oneYear1" class="row">
                <div id="p3" class="oneYear" style="display:none;">
                  <div class="public3 z22">
                    <span>2 Zone</span>
                  </div>
                  <div class="public3 z23">
                    <span>3 Zones</span>
                  </div>
                </div>
              </div>

              <p id="bom"></p>


            </div>

          </div>
        </div>
      </div>
    </div>
    <!-- <script type="module">

      var station_id = 0;
      var tbody = document.getElementById('tbody1');



      function addStation(station_id,station_name,line_num,interchange){
        let trow = document.createElement("tr");
        let td1 = document.createElement('td');
        let td2 = document.createElement('td');
        let td3 = document.createElement('td');
        let td4 = document.createElement('td');

        td1.innerHTML = station_id;
        td2.innerHTML = station_name;
        td3.innerHTML = line_num;
        td4.innerHTML = interchange;

        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);
        trow.appendChild(td4);

        tbody.appendChild(trow);
      }

      function addAllStationsToTable(TheStations){
        station_id = 0;
        tbody.innerHTML="";
        TheStations.forEach(element => {
          addStation(element.StationID, element.StatioName, element.LineNum, element.Interchange);
        });

      }

      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-analytics.js";
      import { getDatabase, set, ref, update, get, child, onValue, remove} from "https://www.gstatic.com/firebasejs/9.6.8/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyB4BGSVyzZE1725rn4T1nQuRXSYp6N6MdE",
        authDomain: "flutter-login-d65de.firebaseapp.com",
        databaseURL: "https://flutter-login-d65de-default-rtdb.firebaseio.com",
        projectId: "flutter-login-d65de",
        storageBucket: "flutter-login-d65de.appspot.com",
        messagingSenderId: "677870289140",
        appId: "1:677870289140:web:5236e24ebdac5a4413dea1",
        measurementId: "G-FCCWWBCY9F"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getDatabase(app);

      var stID = document.getElementById('stationID');
      //add station
      document.getElementById("dele").addEventListener('click',function delstation(){
        var x = stID.value;
        remove(ref(db, 'StationsList/' +x), {
        })

      })




      //add station
      document.getElementById("add").addEventListener('click',function addstation(stName,stId,lineNum,interchangable){

        stName = document.getElementById('stationName').value;
        stId = document.getElementById('stationId').value;
        lineNum = document.getElementById('line').value;
        interchangable = document.getElementById('interchange').value;
        set(ref(db, 'StationsList/' +stId), {
            StationID: stId,
            StatioName: stName,
            LineNum: lineNum,
            Interchange : interchangable,
        })
      })




      //remove station
      //
      // function delstation(){
      //   //stName = document.getElementById('stationName').value;
      //   var staID = document.getElementById('stationID');
      //   // remove(ref(db, 'StationsList/' +stID),{
      //   //
      //   // });
      //   if (staID) {
      //       var input = staID.value;
      //       // remove(ref(db, 'StationsList/' +staID),{
      //       // });
      //       alert(input);
      //     }
      // }

      // function enterCommand() {
      //   var field = document.getElementById("commandfield");
      //   if (field) {
      //     var input = field.value;
      //     alert(input);
      //   }
      // }

      //get stations table from firebase realtime database
      function getAllDataOnce(){
        const dbRef = ref(db);

        get(child(dbRef, "StationsList"))
        .then((snapshot)=>{
          var stations = [];

          snapshot.forEach(childSnapshot =>{
            stations.push(childSnapshot.val());
          });

          addAllStationsToTable(stations);

        });
      }
      window.onload = getAllDataOnce;


    </script> -->

    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.8/firebase-app.js';
      import {
        getFirestore, collection,
        doc, getDocs, setDoc, addDoc, deleteDoc,
        deleteField,getDoc,
        query,where,

      } from 'https://www.gstatic.com/firebasejs/9.6.8/firebase-firestore.js';


      // Follow this pattern to import other Firebase services
      // import { } from 'firebase/<service>';

      // TODO: Replace the following with your app's Firebase project configuration
      const firebaseConfig = {
        apiKey: "AIzaSyB4BGSVyzZE1725rn4T1nQuRXSYp6N6MdE",
        authDomain: "flutter-login-d65de.firebaseapp.com",
        databaseURL: "https://flutter-login-d65de-default-rtdb.firebaseio.com",
        projectId: "flutter-login-d65de",
        storageBucket: "flutter-login-d65de.appspot.com",
        messagingSenderId: "677870289140",
        appId: "1:677870289140:web:5236e24ebdac5a4413dea1",
        measurementId: "G-FCCWWBCY9F"
      };

      // initialize firebase app
      const app = initializeApp(firebaseConfig);
      //init services
      const db = getFirestore(app);
      //collection ref
      const subsRef = collection(db, 'subscriptions');

      // let stationName = document.getElementById("stationName");
      // let line = document.getElementById("line");
      // let numAtLine = document.getElementById("numAtLine");
      // let interchangeable = document.getElementById("interchangeable");
      // let exchangeable = document.getElementById("exchangeable");
      // let wheelChairs = document.getElementById("wheelChairs");
      //
      // let addBtn = document.getElementById("addBtn");
      //
      // async function addStation_autoId(){
      //   const docRef = await addDoc(
      //     stationsRef, {
      //       'name': stationName.value,
      //       'lineNumber': line.value,
      //       'numberAtLine': numAtLine.value,
      //       'isChangable': interchangeable.value,
      //       'exchangeableWithLine': exchangeable.value,
      //       'totalChairs': wheelChairs.value,
      //     }
      //   )
      //   .then(() => {
      //     console.log("data added successfully");
      //     addStation.reset();
      //   })
      //   .catch((error) => {
      //     alert("data not added " + error);
      //   })
      // }
      // addBtn.addEventListener("submit", addStation_autoId);

      //Adding document (stations)
      // const addStation = document.querySelector('.addStation'); //to have a reference of that form
      // addStation.addEventListener('submit', async (e) => {
      //   e.preventDefault() //prevent the default action which is refreshing the page
      //   //
      //   // const docRef = await addDoc(stationsRef, {
      //   //
      //   //   'name': addStation.stationName.value,
      //   //   'lineNumber': Number(addStation.line.value),
      //   //   'numberAtLine': Number(addStation.numAtLine.value),
      //   //   'isChangable': !(addStation.interchangeable.value),
      //   //   'exchangeableWithLine': Number(addStation.exchangeable.value),
      //   //   'totalChairs': Number(addStation.wheelChairs.value),
      //   // })
      //   // .then(()=>{
      //   //   addStation.reset()
      //   // })
      //   //let myValue = document.querySelector('#interchangeable').value;
      //   // let bool = (myValue == 'true');
      //   let bool = document.querySelector('.interchangeable').value == "false" ? false:true;
      //   console.log(bool);
      //   const newDocRef = doc(collection(db, "stations"));
      //   await setDoc(
      //          newDocRef,
      //          {
      //            'name': addStation.stationName.value,
      //            'lineNumber': Number(addStation.line.value),
      //            'numberAtLine': Number(addStation.numAtLine.value),
      //            'isChangable': Boolean(addStation.interchangeable.value === "true"),
      //            // 'exchangeableWithLine': Number(addStation.exchangeable.value),
      //            'totalChairs': Number(addStation.wheelChairs.value),
      //            id: newDocRef.id
      //          }
      //      )
      //      .then(()=>{
      //         console.log(addStation.interchangeable.value);
      //        addStation.reset();
      //        alert("station is added successfully");
      //      })
      //
      //
      //   // console.log("Document written with ID: ", docRef.id);
      //   // const ref = store.collection('stations').doc();
      //   // console.log(ref.id)  // prints the unique id
      //   // ref.set({
      //   //   'id': ref.id,
      //   //   'name': addStation.stationName.value,
      //   //   'lineNumber': addStation.line.value,
      //   //   'numberAtLine': addStation.numAtLine.value,
      //   //   'isChangable': addStation.interchangeable.value,
      //   //   'exchangeableWithLine': addStation.exchangeable.value,
      //   //   'totalChairs': addStation.wheelChairs.value,
      //   // })  // sets the contents of the doc using the id
      //   // .then(() => {  // fetch the doc again and show its data
      //   //     ref.get().then(doc => {
      //   //         console.log(doc.data())  // prints {id: "the unique id"}
      //   //     })
      //   // })
      //
      //
      // })

      //get stations collection data
      let subsData = [];
      let totalSubs = 0;
      //let stations_tbody = document.getElementById('stations-tbody');
      let bom = document.getElementById('bom');
      //Total Issues
      try{
        //get collection data
        let snapshot = await getDocs(subsRef);

        snapshot.docs.forEach(doc => {
          subsData.push({ ...doc.data(), id: doc.id });
        });

        totalSubs = subsData.length;

        //order array by lineNumber then by numberAtLine
        // subsData.sort((a,b) => {
        //   if(a.lineNumber === b.lineNumber){
        //     return a.numberAtLine - b.numberAtLine;
        //   }
        //   return a.lineNumber > b.lineNumber ? 1 : -1;
        // })


        for(let i=0; i<totalSubs; i++){

          // let trow = document.createElement("tr");
          // let td1 = document.createElement('td');
          // let td2 = document.createElement('td');
          // let td3 = document.createElement('td');
          // let td4 = document.createElement('td');
          // let td5 = document.createElement('td');
          // let td6 = document.createElement('td');



          bom.innerHTML = subsData[i].title;
          // td2.innerHTML = stationsData[i].lineNumber;
          // td3.innerHTML = stationsData[i].numberAtLine;
          // if(stationsData[i].exchangeableWithLine > 0){
          //   td4.innerHTML = stationsData[i].isChangable + " with line " + stationsData[i].exchangeableWithLine;
          // }else{td4.innerHTML = stationsData[i].isChangable;}
          // // td4.innerHTML = stationsData[i].isChangable;
          // td5.innerHTML = stationsData[i].totalChairs;
          // td6.innerHTML = stationsData[i].id;

          // trow.appendChild(p);
          // trow.appendChild(td2);
          // trow.appendChild(td3);
          // trow.appendChild(td4);
          // trow.appendChild(td5);
          // trow.appendChild(td6);

          // stations_tbody.appendChild(trow);
        }

      }catch(error){
        console.log(error);
      }

      //delete stations
      // let stationID = document.getElementById('stationID');
      // let delBtn = document.getElementById('delBtn');
      //
      // async function deleteStations(){
      //   let docRef = doc(db,"stations",stationID.value);
      //   const docSnap = await getDoc(docRef);
      //   if(!docSnap.exists()){
      //     alert("Document does not exist");
      //     return;
      //   }
      //   await deleteDoc(docRef)
      //   .then(()=>{
      //     alert("station is deleted successfully");
      //   })
      //   .catch(()=>{
      //     alert("unsuccessful operation, error: " + error);
      //   });
      // }
      // delBtn.addEventListener("click", deleteStations);
      // let flag = 0; //flag = 1 if the station exists
      // const deleteStationForm =  document.querySelector('.deleteForm');
      // deleteStationForm.addEventListener('submit', (e)=>{
      //   e.preventDefault();
      //   const docRef = doc(db, 'stations', deleteStationForm.stationID.value);
      //
      //   for(let i=0; i<totalStations; i++){
      //     if(deleteStationForm.stationID.value === stationsData[i].id){
      //       flag = 1;
      //     }
      //   }
      //   if(flag === 1){
      //     deleteDoc(docRef)
      //     .then(()=>{
      //       deleteStationForm.reset();
      //       alert("Station is deleted successfully");
      //     })
      //     .catch(()=>{
      //         alert("Unsuccessful operation, error: " + error);
      //     });
      //   }else{
      //     deleteStationForm.reset();
      //     alert("This station ID does not exists");
      //   }
      //
      // })

    </script>

    <script>
      function dispExch() {
        document.getElementById("exchangeable").style.display = "block";
      }
      function hideExch() {
        document.getElementById("exchangeable").style.display = "none";
      }
    </script>


    <script>
      function openSubTypes(sub) {
        let i;
        let x = document.getElementsByClassName("subType");
        for (i = 0; i < x.length; i++) {
          x[i].style.display = "none";
        }

        let j=0,k=0,l=0;
        let y = document.getElementsByClassName("oneMonth");
        for (j = 0; j < y.length; j++) {
          y[j].style.display = "none";
        }
        let z = document.getElementsByClassName("threeMonth");
        for (k = 0; k < z.length; k++) {
          z[k].style.display = "none";
        }
        let zz = document.getElementsByClassName("oneYear");
        for (l = 0; l < zz.length; l++) {
          zz[l].style.display = "none";
        }

        document.getElementById(sub).style.display = "block";
      }
    </script>
    <script>
      function openZone(sub) {
        let i=0,j=0,k=0;
        let x = document.getElementsByClassName("oneMonth");
        for (i = 0; i < x.length; i++) {
          x[i].style.display = "none";
        }
        let y = document.getElementsByClassName("threeMonth");
        for (j = 0; j < y.length; j++) {
          y[j].style.display = "none";
        }
        let z = document.getElementsByClassName("oneYear");
        for (k = 0; k < z.length; k++) {
          z[k].style.display = "none";
        }

        document.getElementById(sub).style.display = "block";

      }
    </script>
    <script>
      function openZonee(sub) {
        let i=0,j=0,k=0;
        let x = document.getElementsByClassName("threeMonth");
        for (i = 0; i < x.length; i++) {
          x[i].style.display = "none";
        }
        let y = document.getElementsByClassName("oneMonth");
        for (j = 0; j < y.length; j++) {
          y[j].style.display = "none";
        }
        let z = document.getElementsByClassName("oneYear");
        for (k = 0; k < z.length; k++) {
          z[k].style.display = "none";
        }
        document.getElementById(sub).style.display = "block";
      }
    </script>

    <script>
      function openZoneee(sub) {
        let i=0,j=0,k=0;
        let x = document.getElementsByClassName("oneYear");
        for (i = 0; i < x.length; i++) {
          x[i].style.display = "none";
        }
        let y = document.getElementsByClassName("oneMonth");
        for (j = 0; j < y.length; j++) {
          y[j].style.display = "none";
        }
        let z = document.getElementsByClassName("threeMonth");
        for (k = 0; k < z.length; k++) {
          z[k].style.display = "none";
        }
        document.getElementById(sub).style.display = "block";
      }
    </script>

  </body>
</html>
